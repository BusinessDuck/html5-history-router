!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).router={})}(this,function(t){"use strict";var e=function(t){this.routes=[],this.options=Object.assign({debug:!1},t),this.always(function(){return null}),this._onLocationChange=this._onLocationChange.bind(this),this._subscribe(),this.resolve(),window.addEventListener("DOMContentLoaded",this._onLocationChange)};e.prototype.applyState=function(){return this._onLocationChange(!0)},e.prototype.pushState=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),t!==location.pathname?history.pushState(e,document.title,t):history.replaceState(e,document.title,t),this._resolving?Promise.resolve(!1):this._onLocationChange()},e.prototype.popState=function(){history.back()},e.prototype.replaceState=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),history.replaceState(e,document.title,t),this._onLocationChange()},e.prototype.resolve=function(t){return void 0===t&&(t=function(){return Promise.resolve(!0)}),this._resolver=t,this},e.prototype.on=function(t,e){return this.routes.push({route:t,handler:e}),this},e.prototype.default=function(t){return this.routes.push({route:"",handler:t}),this},e.prototype.always=function(t){return this.alwaysFunc=t,this},e.prototype._getRouteParser=function(t){var e,o=[];return t instanceof RegExp?e=t:(e=t.replace(/([:*])(\w+)/g,function(t,e,n){return o.push(n),"([^/]+)"}).replace(/\*/g,"(?:.*)"),e=new RegExp(e+"(?:/$|$)")),{paramNames:o,regexp:e}},e.prototype._collectRouteParams=function(t,e){return t.slice(1,t.length).reduce(function(t,o,n){return t[e[n]]=decodeURIComponent(o),t},{})},e.prototype._onLocationChange=function(t){var e,o=this,n=decodeURI(location.pathname);return this.options.debug&&(e="pushChange, "+n,console.log("%c[Router]%c "+e,"color: rgb(255, 105, 100);","color: inherit")),t instanceof Event&&(t=!1),this._resolving?this._resolving:this._resolving=this._resolver(this._prevUrl,n).then(function(e){return e?(o._resolving=!1,o._resolveLocation(n,history.state,t)):o._revertState().then(function(){return o._resolving=!1,!1})})},e.prototype._revertState=function(){return this._prevUrl?this.pushState(this._prevUrl,this._prevState):Promise.resolve(this.popState())},e.prototype._resolveLocation=function(t,e,o){return this._handleRoutes(t,e,o),this._saveState(t,e),this.alwaysFunc(t),Promise.resolve(!0)},e.prototype._handleRoutes=function(t,e,o){for(var n=0;n<this.routes.length;n++){var r=this._getRouteParser(this.routes[n].route),i=t.match(r.regexp);if(i){var s=this._collectRouteParams(i,r.paramNames);this.routes[n].handler.call(null,{path:t,state:e,params:s,applied:o});break}}},e.prototype._subscribe=function(){this._subscribed||(window.addEventListener("popstate",this._onLocationChange),this._subscribed=!0)},e.prototype._unsubscribe=function(){this._subscribed&&(window.removeEventListener("popstate",this._onLocationChange),this._subscribed=!1)},e.prototype._saveState=function(t,e){this._prevUrl=t,this._prevState=e},t.Router=e,Object.defineProperty(t,"__esModule",{value:!0})});
