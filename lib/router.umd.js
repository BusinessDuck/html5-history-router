!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).router={})}(this,(function(t){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},o=function(){function t(t){var e=this;this.routes=[],this.routes=[],this.options=Object.assign({debug:!1},t),this.always((function(){return null})),this._listener=function(){return e._onLocationChange(!1)},this._subscribe(),this.resolve(),window.addEventListener("DOMContentLoaded",this._listener)}return t.prototype.dispose=function(){this._prevState=null,this._prevUrl=null,this._unsubscribe()},t.prototype.applyState=function(){return this._saveState(document.location.pathname,history.state),this._onLocationChange(!0)},t.prototype.pushState=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),e.reverted||this._saveState(document.location.pathname,history.state),t!==location.pathname?history.pushState(e,document.title,t):history.replaceState(e,document.title,t),this._resolving?Promise.resolve(!1):this._onLocationChange()},t.prototype.popState=function(){history.back()},t.prototype.replaceState=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),history.replaceState(e,document.title,t),this._onLocationChange()},t.prototype.resolve=function(t){return void 0===t&&(t=function(){return Promise.resolve(!0)}),this._resolver=t,this},t.prototype.on=function(t,e){return this.routes.push({route:t,handler:e}),this},t.prototype.default=function(t){return this.routes.push({route:"",handler:t}),this},t.prototype.always=function(t){return this.alwaysFunc=t,this},t.prototype._getRouteParser=function(t){var e,o=[];if(t instanceof RegExp)e=t;else{var r=t.replace(/([:*])(\w+)/g,(function(t,e,r){return o.push(r),"([^/]+)"})).replace(/\*/g,"(?:.*)");e=new RegExp(r+"(?:/$|$)")}return{paramNames:o,regexp:e}},t.prototype._collectRouteParams=function(t,e){return t.slice(1,t.length).reduce((function(t,o,r){return t[e[r]]=decodeURIComponent(o),t}),{})},t.prototype._onLocationChange=function(t){var e,o=this,r=decodeURI(location.pathname);return this.options.debug&&(e="pushChange, "+r,console.log("%c[Router]%c "+e,"color: rgb(255, 105, 100);","color: inherit")),this._resolving?this._resolving:(this._resolving=this._resolver(this._prevUrl,r).then((function(e){return e?(o._resolving=null,o._resolveLocation(r,history.state,t)):o._revertState().then((function(){return o._resolving=null,e}))})),this._resolving)},t.prototype._revertState=function(){return this._prevUrl?this.pushState(this._prevUrl,e(e({},this._prevState),{reverted:!0})):(this.popState(),Promise.resolve(!0))},t.prototype._resolveLocation=function(t,e,o){return this._handleRoutes(t,e,o),this._saveState(t,e),this.alwaysFunc(t),Promise.resolve(!0)},t.prototype._handleRoutes=function(t,e,o){for(var r=0;r<this.routes.length;r++){var n=this._getRouteParser(this.routes[r].route),s=t.match(n.regexp);if(s){var i=this._collectRouteParams(s,n.paramNames);this.routes[r].handler.call(null,{path:t,state:e,params:i,applied:o});break}}},t.prototype._subscribe=function(){this._subscribed||(window.addEventListener("popstate",this._listener),this._subscribed=!0)},t.prototype._unsubscribe=function(){this._subscribed&&(window.removeEventListener("popstate",this._listener),this._subscribed=!1)},t.prototype._saveState=function(t,e){this._prevUrl=t,this._prevState=e},t}();t.Router=o,Object.defineProperty(t,"__esModule",{value:!0})}));
